<div class="client-dashboard">
  <!-- Professional Navbar -->
  <app-navbar 
    [userRole]="'CLIENT'"
    [userName]="'Carlos Mart√≠nez'"
    [notificationCount]="generalNotifications"
    [messageCount]="messageNotifications"
    [projectCount]="projectNotifications"
    [showSearch]="true"
  ></app-navbar>
  
  <div class="dashboard-layout">
    <!-- Left Sidebar - Filters / Chatbot -->
    <aside class="sidebar-filters">
      <!-- Toggle Buttons -->
      <div class="sidebar-toggle">
        <button 
          class="toggle-btn"
          [class.active]="sidebarMode === 'filters'"
          (click)="sidebarMode = 'filters'"
        >
          <span>üîç</span> Filtros
        </button>
        <button 
          class="toggle-btn"
          [class.active]="sidebarMode === 'chatbot'"
          (click)="sidebarMode = 'chatbot'"
        >
          <span>üí¨</span> Chatbot
        </button>
      </div>

      <!-- Filters Mode -->
      <div *ngIf="sidebarMode === 'filters'" class="filters-content">
        <div class="filters-header">
          <h3>Filtros</h3>
          <button class="clear-filters" (click)="clearFilters()">Limpiar</button>
        </div>
        
        <!-- Sector - Multiselect -->
        <div class="filter-section">
          <h4>Sector</h4>
          <select [(ngModel)]="filters.sector" class="filter-select" multiple size="5">
            <option value="fintech">Fintech & Banca</option>
            <option value="retail">Retail & E-commerce</option>
            <option value="logistica">Log√≠stica & Supply Chain</option>
            <option value="salud">Salud & Healthcare</option>
            <option value="marketing">Marketing & Publicidad</option>
            <option value="manufactura">Manufactura</option>
            <option value="energia">Energ√≠a</option>
            <option value="educacion">Educaci√≥n</option>
          </select>
        </div>

        <!-- Servicio / Producto / Formaci√≥n - Chips -->
        <div class="filter-section">
          <h4>Servicio / Producto / Formaci√≥n</h4>
          <div class="chips-container">
            <button 
              *ngFor="let option of ['Servicio', 'Producto', 'Formaci√≥n']"
              class="chip"
              [class.active]="filters.servicioProductoFormacion.includes(option)"
              (click)="toggleChip('servicioProductoFormacion', option)"
            >
              {{ option }}
            </button>
          </div>
        </div>

        <!-- Coste - Range Slider -->
        <div class="filter-section">
          <h4>Coste (‚Ç¨)</h4>
          <div class="range-inputs">
            <input 
              type="number" 
              [(ngModel)]="filters.coste.min" 
              class="range-input"
              placeholder="M√≠n"
            />
            <span class="range-separator">‚Äî</span>
            <input 
              type="number" 
              [(ngModel)]="filters.coste.max" 
              class="range-input"
              placeholder="M√°x"
            />
          </div>
          <input 
            type="range" 
            [(ngModel)]="filters.coste.max"
            [min]="0"
            [max]="100000"
            class="range-slider"
          />
        </div>

        <!-- Tama√±o y Madurez del Proveedor - Radio Buttons -->
        <div class="filter-section">
          <h4>Tama√±o y Madurez del Proveedor</h4>
          <div class="radio-group">
            <label *ngFor="let option of ['Startup', 'Scale-up', 'Enterprise', 'Cualquiera']" class="radio-label">
              <input 
                type="radio" 
                name="tamanoMadurezProveedor"
                [value]="option"
                [(ngModel)]="filters.tamanoMadurezProveedor"
              />
              <span>{{ option }}</span>
            </label>
          </div>
        </div>

        <!-- Madurez del Use Case - Radio Buttons -->
        <div class="filter-section">
          <h4>Madurez del Use Case</h4>
          <div class="radio-group">
            <label *ngFor="let option of ['Piloto', 'Producci√≥n', 'Escalado', 'Cualquiera']" class="radio-label">
              <input 
                type="radio" 
                name="madurezUseCase"
                [value]="option"
                [(ngModel)]="filters.madurezUseCase"
              />
              <span>{{ option }}</span>
            </label>
          </div>
        </div>

        <!-- Tipo de IA - Toggle -->
        <div class="filter-section">
          <h4>Tipo de IA</h4>
          <div class="toggle-group">
            <button 
              class="toggle-option"
              [class.active]="filters.tipoIA === 'cerrada'"
              (click)="filters.tipoIA = filters.tipoIA === 'cerrada' ? '' : 'cerrada'"
            >
              Cerrada
            </button>
            <button 
              class="toggle-option"
              [class.active]="filters.tipoIA === 'abierta'"
              (click)="filters.tipoIA = filters.tipoIA === 'abierta' ? '' : 'abierta'"
            >
              Abierta
            </button>
            <button 
              class="toggle-option"
              [class.active]="filters.tipoIA === 'mixta'"
              (click)="filters.tipoIA = filters.tipoIA === 'mixta' ? '' : 'mixta'"
            >
              Mixta
            </button>
          </div>
        </div>

        <!-- Modalidad T√©cnica - Checkboxes -->
        <div class="filter-section">
          <h4>Modalidad T√©cnica</h4>
          <div class="checkbox-group">
            <label *ngFor="let option of ['On-premise', 'Cloud', 'H√≠brida', 'SaaS']" class="checkbox-label">
              <input 
                type="checkbox"
                [value]="option"
                [checked]="filters.modalidadTecnica.includes(option)"
                (change)="toggleArray('modalidadTecnica', option, $event)"
              />
              <span>{{ option }}</span>
            </label>
          </div>
        </div>

        <!-- Intervenci√≥n Humana - Toggle Switch -->
        <div class="filter-section">
          <h4>Intervenci√≥n Humana</h4>
          <label class="switch">
            <input 
              type="checkbox"
              [(ngModel)]="filters.intervencionHumana"
            />
            <span class="slider"></span>
            <span class="switch-label">{{ filters.intervencionHumana ? 'S√≠' : 'No' }}</span>
          </label>
        </div>

        <!-- Stack Tecnol√≥gico - Autocomplete -->
        <div class="filter-section">
          <h4>Stack Tecnol√≥gico</h4>
          <input 
            type="text"
            class="autocomplete-input"
            placeholder="Buscar tecnolog√≠as..."
            (keyup.enter)="addToArray('stackTecnologico', $event)"
          />
          <div class="tags-container">
            <span *ngFor="let tag of filters.stackTecnologico" class="tag">
              {{ tag }}
              <button class="tag-remove" (click)="removeFromArray('stackTecnologico', tag)">√ó</button>
            </span>
          </div>
        </div>

        <!-- Integraciones - Autocomplete -->
        <div class="filter-section">
          <h4>Integraciones</h4>
          <input 
            type="text"
            class="autocomplete-input"
            placeholder="Buscar integraciones..."
            (keyup.enter)="addToArray('integraciones', $event)"
          />
          <div class="tags-container">
            <span *ngFor="let tag of filters.integraciones" class="tag">
              {{ tag }}
              <button class="tag-remove" (click)="removeFromArray('integraciones', tag)">√ó</button>
            </span>
          </div>
        </div>

        <!-- Tiempo de integraci√≥n - Dropdown -->
        <div class="filter-section">
          <h4>Tiempo de integraci√≥n</h4>
          <select [(ngModel)]="filters.tiempoIntegracion" class="filter-select">
            <option value="">Cualquiera</option>
            <option value="1-2 semanas">1-2 semanas</option>
            <option value="1 mes">1 mes</option>
            <option value="2-3 meses">2-3 meses</option>
            <option value="3-6 meses">3-6 meses</option>
            <option value="6+ meses">6+ meses</option>
          </select>
        </div>

        <!-- Idiomas - Multiselect -->
        <div class="filter-section">
          <h4>Idiomas</h4>
          <select [(ngModel)]="filters.idiomas" class="filter-select" multiple size="4">
            <option value="es">Espa√±ol</option>
            <option value="en">Ingl√©s</option>
            <option value="fr">Franc√©s</option>
            <option value="de">Alem√°n</option>
            <option value="it">Italiano</option>
            <option value="pt">Portugu√©s</option>
          </select>
        </div>

        <!-- Tama√±o de la Empresa - Checkboxes -->
        <div class="filter-section">
          <h4>Tama√±o de la Empresa (Proveedor)</h4>
          <div class="checkbox-group">
            <label *ngFor="let option of ['Startup', 'Scale-up', 'Enterprise']" class="checkbox-label">
              <input 
                type="checkbox"
                [value]="option"
                [checked]="filters.tamanoEmpresa.includes(option)"
                (change)="toggleArray('tamanoEmpresa', option, $event)"
              />
              <span>{{ option }}</span>
            </label>
          </div>
        </div>

        <!-- Ubicaci√≥n / Soberan√≠a del Dato - Dropdown -->
        <div class="filter-section">
          <h4>Ubicaci√≥n / Soberan√≠a del Dato</h4>
          <select [(ngModel)]="filters.ubicacionSoberania" class="filter-select">
            <option value="">Cualquiera</option>
            <option value="es">Espa√±a</option>
            <option value="eu">Uni√≥n Europea</option>
            <option value="us">Estados Unidos</option>
            <option value="uk">Reino Unido</option>
            <option value="latam">Latinoam√©rica</option>
          </select>
        </div>

        <!-- Regulaci√≥n - Checkboxes -->
        <div class="filter-section">
          <h4>Regulaci√≥n</h4>
          <div class="checkbox-group">
            <label *ngFor="let option of ['GDPR', 'HIPAA', 'SOC 2', 'ISO 27001', 'PCI DSS']" class="checkbox-label">
              <input 
                type="checkbox"
                [value]="option"
                [checked]="filters.regulacion.includes(option)"
                (change)="toggleArray('regulacion', option, $event)"
              />
              <span>{{ option }}</span>
            </label>
          </div>
        </div>

        <!-- Certificaciones - Checkboxes -->
        <div class="filter-section">
          <h4>Certificaciones</h4>
          <div class="checkbox-group">
            <label *ngFor="let option of ['ISO 9001', 'ISO 14001', 'CMMI', 'ITIL']" class="checkbox-label">
              <input 
                type="checkbox"
                [value]="option"
                [checked]="filters.certificaciones.includes(option)"
                (change)="toggleArray('certificaciones', option, $event)"
              />
              <span>{{ option }}</span>
            </label>
          </div>
        </div>

        <!-- Seguridad de datos - Checkboxes -->
        <div class="filter-section">
          <h4>Seguridad de datos</h4>
          <div class="checkbox-group">
            <label *ngFor="let option of ['Encriptaci√≥n', 'Backup autom√°tico', 'Redundancia', 'Auditor√≠a']" class="checkbox-label">
              <input 
                type="checkbox"
                [value]="option"
                [checked]="filters.seguridadDatos.includes(option)"
                (change)="toggleArray('seguridadDatos', option, $event)"
              />
              <span>{{ option }}</span>
            </label>
          </div>
        </div>

        <div class="filter-section">
          <button class="my-cases-btn" (click)="viewMyRFIDCases()">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
              <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"/>
            </svg>
            Mis casos publicados
          </button>
        </div>
      </div>

      <!-- Chatbot Mode -->
      <div *ngIf="sidebarMode === 'chatbot'" class="chatbot-content h-full flex flex-column">
        <p-card styleClass="chatbot-card h-full surface-card border-none shadow-none flex flex-column">
          <ng-template pTemplate="content">
            <div class="flex flex-column h-full">
              <div class="chatbot-header flex align-items-center gap-3 mb-4">
                <p-avatar icon="pi pi-sparkles" styleClass="bg-primary-500 text-white" size="large" shape="circle"></p-avatar>
                <div>
                  <h3 class="m-0 text-xl font-bold text-white">Asistente IA</h3>
                  <p class="m-0 text-sm text-gray-400">Busca soluciones con lenguaje natural</p>
                </div>
              </div>
              
              <div class="chatbot-input-wrapper flex flex-column gap-3 flex-grow-1">
                <textarea 
                  pInputTextarea 
                  [(ngModel)]="chatQuery" 
                  rows="6" 
                  placeholder="Ej: Necesito reducir fraude en transacciones, Automatizar atenci√≥n al cliente..." 
                  class="w-full bg-gray-900 border-gray-700 text-white flex-grow-1"
                  style="resize: none;"
                  (keyup.enter)="onChatSubmit()"
                ></textarea>
                <p-button label="Buscar Soluciones" icon="pi pi-search" styleClass="w-full p-button-primary" (click)="onChatSubmit()"></p-button>
              </div>
              
              <div class="quick-suggestions mt-5">
                <span class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-3">B√∫squedas populares:</span>
                <div class="flex flex-wrap gap-2">
                  <button 
                    pButton 
                    type="button" 
                    *ngFor="let suggestion of suggestions" 
                    [label]="suggestion" 
                    class="p-button-outlined p-button-secondary p-button-sm p-button-rounded text-sm"
                    (click)="onSuggestionClick(suggestion)"
                  ></button>
                </div>
              </div>
            </div>
          </ng-template>
        </p-card>
      </div>
    </aside>
    
    <!-- Main Content -->
    <main class="main-content">
      <!-- Tabs Navigation (Inside Main Content) -->
      <div class="tabs">
        <button 
          class="tab" 
          [class.active]="activeTab === 'marketplace'"
          (click)="activeTab = 'marketplace'"
        >
          Mercado Global
        </button>
        <button 
          class="tab" 
          [class.active]="activeTab === 'received'"
          (click)="activeTab = 'received'"
        >
          Propuestas Recibidas
          <span class="badge" *ngIf="receivedProposals.length > 0">{{receivedProposals.length}}</span>
        </button>
        <button 
          class="tab" 
          [class.active]="activeTab === 'my-requests'"
          (click)="activeTab = 'my-requests'"
        >
          Mis Solicitudes (Innovaci√≥n)
          <span class="badge" *ngIf="myRequests.length > 0">{{myRequests.length}}</span>
        </button>
      </div>

      <!-- MARKETPLACE VIEW -->
      <div *ngIf="activeTab === 'marketplace'">
        <section class="cases-section">
          <div class="section-header">
            <div>
              <h2>Casos de uso</h2>
              <p class="results-count">{{ caseStudies.length }} resultados encontrados</p>
            </div>
            <select class="sort-select">
              <option>M√°s relevantes</option>
              <option>M√°s recientes</option>
              <option>Mejor valorados</option>
            </select>
          </div>
          
          <div class="cases-grid">
            <article 
              *ngFor="let case of caseStudies"
              class="case-card"
              [class.featured]="case.featured"
              (click)="onCaseClick(case)"
            >
              <!-- Case Image -->
              <div class="case-image">
                <img [src]="case.image" [alt]="case.title" />
                <div class="image-overlay"></div>
              </div>
              
              <!-- Relevance Score -->
              <div class="case-header">
                <span class="relevance-badge" [class.featured-badge]="case.featured">
                  <span *ngIf="case.featured" class="premium-icon">‚≠ê</span>
                  {{ case.relevanceScore }}% coincidencia
                </span>
              </div>
              
              <!-- Title -->
              <h3 class="case-title">{{ case.title }}</h3>
              
              <!-- Provider Info -->
              <div class="case-provider">
                <img [src]="case.provider.logo" [alt]="case.provider.name" class="provider-logo" />
                <span class="provider-name">{{ case.provider.name }}</span>
                <span *ngIf="case.provider.verified" class="verified-icon">
                  <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
                    <path fill-rule="evenodd" d="M10.067.87a2.89 2.89 0 0 0-4.134 0l-.622.638-.89-.011a2.89 2.89 0 0 0-2.924 2.924l.01.89-.636.622a2.89 2.89 0 0 0 0 4.134l.637.622-.011.89a2.89 2.89 0 0 0 2.924 2.924l.89-.01.622.636a2.89 2.89 0 0 0 4.134 0l.622-.637.89.011a2.89 2.89 0 0 0 2.924-2.924l-.01-.89.636-.622a2.89 2.89 0 0 0 0-4.134l-.637-.622.011-.89a2.89 2.89 0 0 0-2.924-2.924l-.89.01-.622-.636zm.287 5.984l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7 8.793l2.646-2.647a.5.5 0 0 1 .708.708z"/>
                  </svg>
                </span>
              </div>
              
              <!-- KPIs -->
              <div class="case-metrics">
                <div *ngFor="let kpi of case.kpis" class="metric-item">
                  <span class="metric-label">{{ kpi.label }}</span>
                  <span class="metric-value">{{ kpi.value }}</span>
                </div>
              </div>
              
              <!-- Tags -->
              <div class="case-tags">
                <span *ngFor="let tag of case.tags" class="tag">{{ tag }}</span>
              </div>
              
              <!-- Footer -->
              <div class="case-footer">
                <button class="view-case-btn">
                  Ver caso de estudio
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8z"/>
                  </svg>
                </button>
              </div>
            </article>
          </div>
        </section>
      </div>

      <!-- RECEIVED PROPOSALS VIEW -->
      <div *ngIf="activeTab === 'received'">
        <section class="cases-section">
          <div class="section-header">
            <div>
              <h2>Propuestas Recibidas</h2>
              <p class="subtitle">Casos de uso y ofertas enviadas directamente a ti</p>
            </div>
          </div>
          
          <div class="cases-grid">
            <article 
              *ngFor="let case of receivedProposals"
              class="case-card featured"
              (click)="onCaseClick(case)"
            >
              <div class="case-header">
                <span class="relevance-badge featured-badge">
                  <span class="premium-icon">üì•</span>
                  Oferta Privada
                </span>
              </div>
              
              <h3 class="case-title">{{ case.title }}</h3>
              
              <div class="case-provider">
                <span class="provider-avatar-sm">{{ case.provider.logo }}</span>
                <span class="provider-name">{{ case.provider.name }}</span>
              </div>
              
              <div class="case-metrics">
                <div *ngFor="let kpi of case.kpis" class="metric-item">
                  <span class="metric-label">{{ kpi.label }}</span>
                  <span class="metric-value">{{ kpi.value }}</span>
                </div>
              </div>
              
              <div class="case-tags">
                <span *ngFor="let tag of case.tags" class="tag">{{ tag }}</span>
              </div>
              
              <div class="case-footer">
                <button class="view-case-btn">
                  Revisar Propuesta
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8z"/>
                  </svg>
                </button>
              </div>
            </article>
          </div>
        </section>
      </div>

      <!-- MY REQUESTS VIEW -->
      <div *ngIf="activeTab === 'my-requests'">
        <section class="cases-section">
          <div class="section-header">
            <div>
              <h2>Mis Solicitudes de Innovaci√≥n</h2>
              <p class="subtitle">Gestiona tus retos publicados y revisa las respuestas</p>
            </div>
            <button class="primary-btn" (click)="publishRFP()">
              + Publicar Nuevo Reto
            </button>
          </div>
          
          <div class="cases-grid">
            <article 
              *ngFor="let req of myRequests" 
              class="case-card"
              (click)="viewResponses(req.id)"
            >
              <div class="case-header">
                <span class="relevance-badge" [class.featured-badge]="req.status === 'Active'">
                  <span class="premium-icon">{{ req.status === 'Active' ? 'üü¢' : 'üî¥' }}</span>
                  {{ req.status === 'Active' ? 'Activo' : 'Cerrado' }}
                </span>
                <span class="date-badge" style="color: #a0aec0; font-size: 0.8rem;">{{ req.date }}</span>
              </div>
              
              <h3 class="case-title">{{ req.title }}</h3>
              
              <div class="case-metrics">
                <div class="metric-item">
                  <span class="metric-label">Presupuesto</span>
                  <span class="metric-value">{{ req.budget }}</span>
                </div>
                <div class="metric-item">
                  <span class="metric-label">Respuestas</span>
                  <span class="metric-value highlight">{{ req.responses }}</span>
                </div>
              </div>
              
              <div class="case-footer">
                <button class="view-case-btn" (click)="viewResponses(req.id); $event.stopPropagation()">
                  Ver Respuestas
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8z"/>
                  </svg>
                </button>
              </div>
            </article>
          </div>
        </section>
      </div>
    </main>
  </div>
</div>
