<div class="company-page">
  <p-toast></p-toast>

  <app-navbar 
    *ngIf="showNavbar"
    userRole="CLIENT"
    userName="Carlos Martínez"
    [notificationCount]="3"
    [messageCount]="2"
    [projectCount]="4"
  ></app-navbar>
  
  <div class="container">
    <!-- Page Header -->
    <div class="page-header mb-4">
      <div>
        <h1 class="page-title">
          <i class="pi pi-building mr-2"></i>
          Mi Empresa
        </h1>
        <p class="page-subtitle">Gestiona los perfiles y departamentos de tu organización</p>
      </div>
      <p-button 
        label="Invitar Miembro" 
        icon="pi pi-user-plus" 
        (click)="inviteMember()"
      ></p-button>
    </div>

    <!-- Company Overview Card -->
    <p-card styleClass="company-overview-card mb-4">
      <div class="company-header">
        <div class="company-logo-wrapper">
          <p-avatar 
            [label]="companyInfo.initials" 
            size="xlarge" 
            shape="circle"
            [style]="{'background-color': '#0d86ff', 'color': '#ffffff', 'font-size': '2rem', 'width': '100px', 'height': '100px'}"
          ></p-avatar>
        </div>
        <div class="company-details flex-1">
          <h2 class="company-name">{{ companyInfo.name }}</h2>
          <p class="company-industry">
            <i class="pi pi-tag mr-2"></i>
            {{ companyInfo.industry }}
          </p>
          <div class="company-meta">
            <p-chip>
              <i class="pi pi-map-marker mr-2"></i>
              {{ companyInfo.location }}
            </p-chip>
            <p-chip>
              <i class="pi pi-users mr-2"></i>
              {{ companyInfo.employees }} Empleados
            </p-chip>
            <p-chip>
              <i class="pi pi-globe mr-2"></i>
              {{ companyInfo.website }}
            </p-chip>
          </div>
        </div>
        <div>
          <p-button 
            label="Editar Perfil" 
            icon="pi pi-pencil" 
            styleClass="p-button-outlined"
            (click)="editProfile()"
          ></p-button>
        </div>
      </div>
    </p-card>

    <!-- Departments -->
    <div class="departments-container">
      <div *ngFor="let dept of departments" class="department-section mb-4">
        <div class="dept-header mb-3">
          <h3 class="dept-title">
            <i class="pi pi-sitemap mr-2"></i>
            {{ dept.name }}
          </h3>
          <p-badge 
            [value]="dept.memberCount + ' miembros'" 
            severity="info"
          ></p-badge>
        </div>

        <div class="members-grid">
          <p-card 
            *ngFor="let member of dept.members" 
            styleClass="member-card"
          >
            <div class="member-content">
              <p-avatar 
                [label]="member.initials" 
                size="large" 
                shape="circle"
                [style]="{'background-color': '#1e2736', 'color': '#0d86ff'}"
              ></p-avatar>
              <div class="member-info flex-1">
                <h4 class="member-name">{{ member.name }}</h4>
                <p class="member-role">{{ member.role }}</p>
                <p class="member-email">
                  <i class="pi pi-envelope mr-1"></i>
                  {{ member.email }}
                </p>
              </div>
              <p-tag 
                [value]="getStatusLabel(member.status)" 
                [severity]="getStatusSeverity(member.status)"
              ></p-tag>
            </div>
          </p-card>

          <!-- Add Member Card -->
          <div class="add-member-card" (click)="addTeamMember()">
            <i class="pi pi-plus text-4xl mb-2"></i>
            <span>Añadir al equipo</span>
          </div>
        </div>

        <p-divider *ngIf="dept !== departments[departments.length - 1]"></p-divider>
      </div>
    </div>
  </div>

  <!-- Invite Dialog -->
  <p-dialog 
    [(visible)]="showInviteDialog" 
    header="Invitar Miembro al Equipo" 
    [modal]="true" 
    [style]="{width: '500px'}" 
    [draggable]="false" 
    [resizable]="false"
  >
    <div class="p-fluid">
      <div class="field mb-4">
        <label for="email" class="font-bold mb-2">
          <i class="pi pi-envelope mr-1"></i>
          Email del Miembro
        </label>
        <input 
          id="email"
          type="email" 
          pInputText 
          placeholder="ejemplo@empresa.com"
          class="w-full"
        />
      </div>
      
      <div class="field mb-4">
        <label for="role" class="font-bold mb-2">
          <i class="pi pi-briefcase mr-1"></i>
          Rol
        </label>
        <input 
          id="role"
          type="text" 
          pInputText 
          placeholder="Ej: Developer, Manager..."
          class="w-full"
        />
      </div>

      <div class="field mb-4">
        <label for="department" class="font-bold mb-2">
          <i class="pi pi-sitemap mr-1"></i>
          Departamento
        </label>
        <p-dropdown 
          id="department"
          [options]="departmentOptions" 
          optionLabel="label"
          optionValue="value"
          placeholder="Selecciona un departamento"
          styleClass="w-full"
        ></p-dropdown>
      </div>
    </div>
    
    <ng-template pTemplate="footer">
      <p-button 
        label="Cancelar" 
        icon="pi pi-times" 
        (click)="showInviteDialog = false" 
        styleClass="p-button-text"
      ></p-button>
      <p-button 
        label="Enviar Invitación" 
        icon="pi pi-send" 
        (click)="showInviteDialog = false"
      ></p-button>
    </ng-template>
  </p-dialog>
</div>
