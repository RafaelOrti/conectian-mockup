<div class="monitoring-page">
  <app-navbar 
    userRole="ADMIN"
    userName="Admin User"
    [notificationCount]="5"
  ></app-navbar>
  
  <div class="container">
    <!-- Page Header -->
    <div class="page-header mb-4">
      <div>
        <h1 class="page-title">
          <i class="pi pi-chart-bar mr-2"></i>
          Monitoreo del Sistema
        </h1>
        <p class="page-subtitle">Estado de salud, logs y métricas de rendimiento en tiempo real</p>
      </div>
      <div class="header-actions">
        <p-chip 
          label="Sistema Operativo" 
          icon="pi pi-check-circle"
          [style]="{'background': 'rgba(16, 185, 129, 0.2)', 'color': '#10b981', 'font-weight': '600'}"
        ></p-chip>
        <p-button 
          label="Actualizar" 
          icon="pi pi-refresh" 
          (click)="refreshData()"
        ></p-button>
      </div>
    </div>

    <!-- System Health Cards -->
    <div class="metrics-grid mb-4">
      <p-card *ngFor="let metric of metrics" styleClass="metric-card">
        <div class="metric-header">
          <span class="metric-label">{{ metric.label }}</span>
          <span class="metric-value">{{ metric.value }}</span>
        </div>
        <div class="metric-progress">
          <p-progressBar 
            [value]="metric.percentage" 
            [showValue]="false"
            [style]="{'height': '8px'}"
            [styleClass]="metric.status === 'warning' ? 'progress-warning' : metric.status === 'critical' ? 'progress-danger' : 'progress-success'"
          ></p-progressBar>
        </div>
        <div class="metric-footer">
          <span class="metric-details">{{ metric.details }}</span>
          <p-chip 
            [label]="metric.trend === 'up' ? 'Aumentando' : metric.trend === 'down' ? 'Mejorando' : 'Estable'"
            [icon]="getTrendIcon(metric.trend)"
            [style]="{'background': 'rgba(255, 255, 255, 0.05)', 'color': getTrendColor(metric.trend), 'font-size': '0.75rem'}"
          ></p-chip>
        </div>
      </p-card>
    </div>

    <div class="grid">
      <!-- Response Time Chart -->
      <div class="col-12 lg:col-8">
        <p-card styleClass="chart-card">
          <ng-template pTemplate="header">
            <div class="card-header-custom">
              <h3>
                <i class="pi pi-clock mr-2"></i>
                Tiempo de Respuesta
              </h3>
              <p-tag value="Últimas 24h" severity="info"></p-tag>
            </div>
          </ng-template>
          <div class="chart-container">
            <p-chart 
              type="line" 
              [data]="responseTimeChart" 
              [options]="getChartOptions()"
              [style]="{'height': '300px'}"
            ></p-chart>
          </div>
        </p-card>
      </div>

      <!-- Active Sessions -->
      <div class="col-12 lg:col-4">
        <p-card styleClass="sessions-card">
          <ng-template pTemplate="header">
            <div class="card-header-custom">
              <h3>
                <i class="pi pi-users mr-2"></i>
                Sesiones Activas
              </h3>
              <p-badge value="LIVE" severity="success"></p-badge>
            </div>
          </ng-template>
          
          <div class="sessions-content">
            <div class="session-stat">
              <div class="stat-icon users">
                <i class="pi pi-user text-2xl"></i>
              </div>
              <div class="stat-info">
                <div class="stat-value">{{ activeUsers }}</div>
                <div class="stat-label">Usuarios Online</div>
              </div>
            </div>

            <p-divider></p-divider>

            <div class="session-stat">
              <div class="stat-icon countries">
                <i class="pi pi-globe text-2xl"></i>
              </div>
              <div class="stat-info">
                <div class="stat-value">{{ activeCountries }}</div>
                <div class="stat-label">Países</div>
              </div>
            </div>

            <p-divider></p-divider>

            <div class="session-stat">
              <div class="stat-icon mobile">
                <i class="pi pi-mobile text-2xl"></i>
              </div>
              <div class="stat-info">
                <div class="stat-value">{{ mobilePercentage }}%</div>
                <div class="stat-label">Dispositivos Móviles</div>
              </div>
            </div>
          </div>
        </p-card>
      </div>

      <!-- Logs Table -->
      <div class="col-12 lg:col-7">
        <p-card styleClass="logs-card">
          <ng-template pTemplate="header">
            <div class="card-header-custom">
              <h3>
                <i class="pi pi-list mr-2"></i>
                Logs de Errores Recientes
              </h3>
              <p-button 
                label="Ver Todos" 
                icon="pi pi-external-link" 
                styleClass="p-button-text p-button-sm"
              ></p-button>
            </div>
          </ng-template>

          <p-table [value]="logs" styleClass="p-datatable-sm">
            <ng-template pTemplate="header">
              <tr>
                <th>HORA</th>
                <th>NIVEL</th>
                <th>MENSAJE</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-log>
              <tr>
                <td>
                  <span class="log-time">
                    <i class="pi pi-clock mr-1"></i>
                    {{ log.time }}
                  </span>
                </td>
                <td>
                  <p-tag 
                    [value]="log.level.toUpperCase()" 
                    [severity]="getLogSeverity(log.level)"
                    [icon]="log.level === 'error' ? 'pi pi-times-circle' : log.level === 'warning' ? 'pi pi-exclamation-triangle' : 'pi pi-info-circle'"
                  ></p-tag>
                </td>
                <td>{{ log.message }}</td>
              </tr>
            </ng-template>
          </p-table>
        </p-card>
      </div>

      <!-- Traffic Chart -->
      <div class="col-12 lg:col-5">
        <p-card styleClass="chart-card">
          <ng-template pTemplate="header">
            <div class="card-header-custom">
              <h3>
                <i class="pi pi-chart-line mr-2"></i>
                Tráfico Semanal
              </h3>
              <p-tag value="Última Semana" severity="info"></p-tag>
            </div>
          </ng-template>
          <div class="chart-container">
            <p-chart 
              type="bar" 
              [data]="trafficChart" 
              [options]="getChartOptions()"
              [style]="{'height': '300px'}"
            ></p-chart>
          </div>
        </p-card>
      </div>
    </div>
  </div>
</div>
