<div>
  <app-navbar 
    [userRole]="'PROVIDER'" 
    [userName]="'Mar√≠a Gonz√°lez'" 
    [notificationCount]="2"
    [messageCount]="3"
  ></app-navbar>
  
  <div class="leads-crm-container">
    <header class="crm-header">
      <h1>Bandeja de Leads y Proyectos</h1>
      <div class="search-filters">
        <input type="text" placeholder="Buscar leads, empresas, proyectos..." class="search-input" />
        <button class="filter-btn">Fecha ‚ñº</button>
        <button class="filter-btn">Prioridad ‚ñº</button>
        <button class="filter-btn">Fuente ‚ñº</button>
      </div>
    </header>
    
    <!-- Tabs para filtrar vista -->
    <div class="view-tabs">
      <button 
        class="view-tab"
        [class.active]="activeView === 'all'"
        (click)="activeView = 'all'"
      >
        <span>üìã</span> Todos ({{ getAllCount() }})
      </button>
      <button 
        class="view-tab"
        [class.active]="activeView === 'leads'"
        (click)="activeView = 'leads'"
      >
        <span>üíº</span> Leads ({{ getLeadsCount() }})
      </button>
      <button 
        class="view-tab"
        [class.active]="activeView === 'projects'"
        (click)="activeView = 'projects'"
      >
        <span>üöÄ</span> Proyectos ({{ getProjectsCount() }})
      </button>
    </div>
    
    <!-- Kanban Board -->
    <div class="kanban-board">
      <div *ngFor="let column of columns" class="kanban-column" [attr.data-color]="column.color">
        <div class="column-header" [class]="'header-' + column.color">
          <h3>{{ column.title }} ({{ column.count }})</h3>
        </div>
        
        <div class="column-content">
          <app-card *ngFor="let lead of column.leads" class="lead-card">
            <!-- Drag Handle -->
            <div class="drag-handle">‚ãÆ‚ãÆ</div>
            
            <!-- Company Info -->
            <div class="lead-header">
              <span class="company-logo">{{ lead.logo }}</span>
              <div class="company-info">
                <h4>{{ lead.companyName }}</h4>
                <span *ngIf="lead.isProject" class="project-badge">üöÄ Proyecto Activo</span>
              </div>
            </div>
            
            <!-- Priority Badge -->
            <app-badge 
              [type]="lead.priority === 'Alta' ? 'danger' : lead.priority === 'Media' ? 'warning' : 'info'"
              class="priority-badge"
            >
              {{lead.priority}}
            </app-badge>
            
            <!-- Project Info (si es proyecto) -->
            <div *ngIf="lead.isProject" class="project-info">
              <h5 class="project-title">{{ lead.projectTitle }}</h5>
              <div *ngIf="lead.value" class="lead-info">
                <small>üí∞ Valor: ${{ lead.value?.toLocaleString() }}</small>
              </div>
              <div *ngIf="lead.timeline" class="lead-info">
                <small>‚è±Ô∏è Timeline: {{ lead.timeline }}</small>
              </div>
              <div *ngIf="lead.acceptedDate" class="lead-info">
                <small>üìÖ Aceptado: {{ lead.acceptedDate }}</small>
              </div>
              <div *ngIf="lead.lastActivity" class="lead-info">
                <small>üïê √öltima actividad: {{ lead.lastActivity }}</small>
              </div>
              <div *ngIf="lead.projectStatus" class="project-status-badge">
                <app-badge 
                  [type]="lead.projectStatus === 'active' ? 'success' : lead.projectStatus === 'completed' ? 'info' : 'warning'"
                >
                  {{ getProjectStatusLabel(lead.projectStatus) }}
                </app-badge>
              </div>
            </div>
            
            <!-- Lead Info (si es lead normal) -->
            <ng-container *ngIf="!lead.isProject">
              <div *ngIf="lead.contactDate" class="lead-info">
                <small>Contactado: {{ lead.contactDate }}</small>
              </div>
              <div *ngIf="lead.nextFollowUp" class="lead-info">
                <small class="text-purple">Pr√≥ximo follow-up: {{ lead.nextFollowUp }}</small>
              </div>
              <div *ngIf="lead.proposalSent" class="lead-info">
                <small class="text-success">‚úì Propuesta enviada</small>
                <div *ngIf="lead.progress" class="mini-progress">
                  <div class="progress" [style.width.%]="lead.progress"></div>
                  <span>{{ lead.progress }}% completo</span>
                </div>
              </div>
              <div *ngIf="column.id === 'ganado'" class="lead-info">
                <button class="action-link">Solicitar rese√±a</button>
              </div>
              <div *ngIf="lead.followUpDate" class="lead-info">
                <small class="text-muted">{{ lead.followUpDate }}</small>
              </div>
            </ng-container>
            
            <!-- Actions -->
            <div class="lead-actions">
              <button 
                *ngIf="lead.isProject && lead.dealRoomId" 
                class="deal-room-btn"
                (click)="openDealRoom(lead.dealRoomId!); $event.stopPropagation()"
              >
                Abrir Deal Room ‚Üí
              </button>
              <ng-container *ngIf="!lead.isProject">
                <button class="icon-btn" title="Ver">üëÅÔ∏è</button>
                <button class="icon-btn" title="Chat">üí¨</button>
                <button class="icon-btn" title="M√°s">‚ãÆ</button>
              </ng-container>
            </div>
          </app-card>
          
          <!-- Alert for Nuevo column -->
          <div *ngIf="column.id === 'nuevo' && column.leads.length > 0" class="column-alert">
            ‚è∞ Responde en <24h para todos los leads nuevos
          </div>
        </div>
      </div>
    </div>
    
    <!-- Metrics Bar -->
    <footer class="metrics-bar">
      <div class="metric">
        <span class="metric-label">Conversion rate:</span>
        <span class="metric-value">{{ metrics.conversionRate }}%</span>
      </div>
      <div class="metric">
        <span class="metric-label">Tiempo promedio:</span>
        <span class="metric-value">{{ metrics.avgTime }} d√≠as</span>
      </div>
      <div class="metric">
        <span class="metric-label">Ganados este mes:</span>
        <span class="metric-value text-success">{{ metrics.wonThisMonth }}</span>
      </div>
    </footer>
  </div>
</div>
